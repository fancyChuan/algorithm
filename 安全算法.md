## 安全算法

数据传输时的四个问题：
- 窃听
    - 解决办法：使用加密技术
   
- 假冒
    - 应对方式：使用消息认证码或数字签名
- 篡改
    - 应对方式：使用消息认证码或数字签名
    
- 事后否认：可能会导致互联网上的商业交易或者合同签署无法成立
    - 应对方式：数字签名
    
> 数字签名技术存在“无法确定公开密钥的制作者”的问题，需要使用“数字证书”技术


#### 加密
- 加密就是用密钥对数据进行数值运算，把数据编程第三者无法理解的形式的过程
- 解密就是通过密钥进行数值计算，把密文恢复成原本数据的过程



#### 哈希函数hash
特点：
- 输出的哈希值数据长度不变
- 输入的数据相同，输出的数据也相同
- 输入的数据相似，哪怕有一丁点的差别，输出的哈希值差异也会很大，并不会导致输出的哈希值也相似
- 哈希冲突：即使输入的两个数据完成不同，输出的结果也可能是相同的，虽然出现这种情况的该类极低。
- 不可能从哈希值反向推算出原本的数据。输入和输出不可逆

哈希函数算法中具有代表性的有：MD5、SHA-1和SHA-2等。SHA-2是使用最广泛的，而md5和sha-1存在安全隐患


哈希函数可以很安全的用于基于密码的用户认证

#### 共享密钥加密
加密和解密都使用相同密钥的，所以也称为“对称加密”

主要的算法有：凯撒密码、AES、DES、动态口令等。其中AES使用最为广泛

加密比较快， 但是就存在密钥分配问题。一般可以使用“密钥交换协议”和“公开密钥加密”两种方法



#### 公开密钥加密
加解密使用不同的密钥，也叫“非对称加密”，加密用的密钥叫公钥，解密用的叫私钥

实现的算法有：RAS算法、椭圆曲线加密算法。RSA使用最为广泛

- 公开密钥存在安全性问题，容易中途被替换，而使用公钥的人根本不知道公钥是否已经被替换
- 这种加密方式还有一个问题就是加解密都比较耗时

通过中途替换公开密钥来窃听数据的攻击方法叫做：中间人攻击。

实现这种加密方式的要求：
- 可以使用某个数值对数据进行加密
- 使用另一个数值对加密数据进行计算可以让数据恢复原样
- 无法从一种密钥推算出另一种密钥

#### 混合加密
加密：使用共享密钥加密对数据进行加密。使用的密钥需要用没有密钥分配问题的公开密钥加密进行处理

过程：
- B先把公钥发送给A
- A通过公钥对需要给B的共享密钥进行加密，之后传给B
- B拿到密文后用私钥进行解密，拿到共享密钥
- A再使用共享密钥进行加密，之后可以安全的传给B


SSL（Secure Sockets Layer安全套接层）协议也使用了混合加密方法，现在已经升级命名为TLS传输层安全

#### 迪菲-赫尔曼密钥交换
这是一种可以在通信双方之间安全交换密钥的方法：通过合成密钥

合成密钥的特征：
- 即使持有密钥P和合成后的密钥P-S，也无法把密钥S提取出来
- 不管是怎么合成来的米哟啊都可以把它作为新的元素继续和密钥进行合成。比如P可以和P-S继续合成P-P-S
- 密钥的合成结果与合成顺序无关，只与使用了哪些密钥有关

根据素数P、生成元G和G^x mod P 求出x的问题就是“离散对数问题”，人们至今未找到问题的解法，这个算法就是利用了这个数学难题

#### 消息认证码
消息认证码MAC（Message Authentication Code）常用的算法有HMAC、OMAC、CMAC等，其中HMAC使用最为广泛

加密过程；
- 使用密钥加密得到密文
- 通过密钥+密文得到的结果（比如字符串拼接）通过某种算法计算得到消息认证码
- 把消息认证码MAC发送给对方

解密过程：
- 接收方使用密文和密钥生成MAC并与收到的MAC对比
- MAC如果一致，说明没问题，就可以使用密钥解密密文了

存在的问题：
- AB双放都有相同的密钥，都可以计算得到MAC，这条消息就不能确定是从哪里来的。A可以自己生成并谎称是B计算给他的
- 解决方法：使用数字签名


#### 数字签名
可以实现消息认证码的认证和检测篡改功能，还可以预防时候否认问题的存在

数字签名的生成使用的是公开密钥加密，只不过跟公开密钥加密方法的使用过程相反：
- 发送方使用私钥加密消息，加密后的消息就是数字签名
- 接收方使用公钥对密文进行解密

在数字签名中，是吧只能由A来加密的密文作为签名来使用

RAS算法可以（不是所有公开密钥加密方式都有这个性质）：
- 使用公钥加密的数据都可以使用私钥解密
- 使用私钥加密的数据都可以使用公钥解析

> 实际使用时，为了提高效率，一般是先求得消息的哈希值，然后再对hash值加密作为数字签名

存在的问题：
- 无法确定发布公钥的人是谁。收到的公钥也没有任何制作者的信息。所以接受者可能收到某个冒充发送者的人制作的公钥
- 使用数字证书可以解决这个问题

#### 数字证书

工作过程：
- A 向认证中心申请发行证书，把公开密钥Pa和包含邮箱信息的个人资料发送给认证中心
- 认证中心检查确认之后使用自己的私钥Sc根据A的资料生成数字签名。将生成的数字签名和质量放到同一个文件夹中然后把文件发送给A
- 这个文件就是A的数字证书，A把这个数字证书（拥有公钥Pa和A的信息）发给B
- B收到证书后确认证书的邮件地址确实是A的地址。之后获取认证中心的公钥对证书内的签名进行验证，判断是否为认证中心给出的签名

> 认证中心的公钥也是通过数字证书的形式交付的，会有更高级别的认证中心对这个认证中心署名

> 根认证中心（root CA）:其自身的正当性由自己证明。对跟认证中心进行证明的证书称为“根证书”

数字证书通过认证中心来担保公钥的制作者，这一系列的技术规范统称为“公钥基础设施” 